<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.sigcomt.gestionProyectos.repositorio.anteproyecto.ProyectoDao">

	<!-- INI - PROYECTO -->
	<select id="listarProyectoByDetalleEstadoProyectoByEstado" parameterType= "map" resultType="Proyecto">
		select py."ID_PROYECTO" as idProyecto,
				py."NOMBRE_PROYECTO" as nombreProyecto 
		from "CREAR_PROYECTO"."PROYECTO" py
		inner join "CREAR_PROYECTO"."DETALLE_ESTADO_PROYECTO" detEstPy
		on detEstPy."ID_PROYECTO" = py."ID_PROYECTO"
		where py."ESTADO" = #{estado}
		and detEstPy."ID_ESTADO_PROYECTO" = #{idEstadoProyecto}
		and detEstPy."ESTADO" = #{estado}
	</select>
	
	<select id="buscarProyectoByDetalleEstadoProyectoByEstado"  resultType="Proyecto">
		select py."ID_PROYECTO" as idProyecto,
			py."NOMBRE_PROYECTO" as nombreProyecto,
			py."NOMBRE_EMPRESA" as nombreEmpresa,	
			tipoPy."DESCRIPCION_TIPO_PROYECTO" as descripcionTipoProyecto,
			to_char(py."FECHA_CONTACTO", 'dd-mm-yyyy')as fechaContactoString,
			(select per."NOMBRE_PERSONA"||' '||per."APELLIDO_PERSONA" 
			from "CREAR_PROYECTO"."PERSONA" per
			inner join "seguridad"."security_user" secUser
			on secUser."ID_PERSONA" = per."ID_PERSONA"
			inner join "seguridad"."security_rol_user" secRolUser
			on secRolUser."id_user" = secUser."id_user"
			where secRolUser."id_detalle" = py."ID_RESPONSABLE_PROYECTO") as nombreResponsable,
			(select per."NOMBRE_PERSONA"||' '||per."APELLIDO_PERSONA" 
			from "CREAR_PROYECTO"."PERSONA" per
			inner join "seguridad"."security_user" secUser
			on secUser."ID_PERSONA" = per."ID_PERSONA"
			inner join "seguridad"."security_rol_user" secRolUser
			on secRolUser."id_user" = secUser."id_user"
			where secRolUser."id_detalle" = py."ID_EJECUTIVO_CUENTA") as nombreEjecutivo	
		from "CREAR_PROYECTO"."PROYECTO" py
		inner join "CREAR_PROYECTO"."DETALLE_ESTADO_PROYECTO" detEstPy
		on detEstPy."ID_PROYECTO" = py."ID_PROYECTO"
		inner join "CREAR_PROYECTO"."TIPO_PROYECTO" tipoPy
		on tipoPy."ID_TIPO_PROYECTO" = py."ID_TIPO_PROYECTO"
		where py."ESTADO" = #{estado}
		and detEstPy."ID_ESTADO_PROYECTO" = #{idEstadoProyecto}
		and detEstPy."ESTADO" = #{estado}
		<if test="idEmpresa != null and idEmpresa != ''">
			and py."ID_EMPRESA" = #{idEmpresa} 
		</if>
		<if test="fechaInicio != null and fechaInicio != ''">
			and to_char(py."FECHA_CONTACTO", 'dd/mm/yyyy') >= #{fechaInicio} 
		</if>
		<if test="fechaFin != null and fechaFin != ''">
			<![CDATA[
			and to_char(py."FECHA_CONTACTO", 'dd/mm/yyyy') <= #{fechaFin}
			]]>
		</if>
		<if test="idTipoProyecto != null and idTipoProyecto != ''">
			and py."ID_TIPO_PROYECTO" = #{idTipoProyecto} 
		</if>
		<if test="idResponsableProyecto != null and idResponsableProyecto != ''">
			and py."ID_RESPONSABLE_PROYECTO" = #{idResponsableProyecto} 
		</if>
		<if test="idEjecutivoCuenta != null and idEjecutivoCuenta != ''">
			and py."ID_EJECUTIVO_CUENTA" = #{idEjecutivoCuenta} 
		</if> 
		<if test="idProyecto != null and idProyecto != ''">
			and py."ID_PROYECTO" = #{idProyecto} 
		</if> 
	</select>
	
	<insert id="grabarProyectoByEstado" parameterType="Proyecto">
        <selectKey keyProperty="idProyecto" resultType="Long" order="BEFORE">
            select NEXTVAL('"CREAR_PROYECTO"."SQ_PROYECTO"')
        </selectKey>
        insert into "CREAR_PROYECTO"."PROYECTO" 
        ("ID_PROYECTO",
        "ID_PROYECTO_ASOCIADO",
        "FECHA_CONTACTO",
        "ID_TIPO_PROYECTO",
        "ID_EJECUTIVO_CUENTA",
        "ID_RESPONSABLE_PROYECTO",
        "NOMBRE_PROYECTO",
        "ALCANCE_INICIAL",
        "OBJETIVO_INICIAL",
        "ESTADO",
        "ID_EMPRESA")
        values
        (#{idProyecto}, 
        #{idProyectoAsociado},
        #{fechaContacto}, 
        #{idTipoProyecto},
        #{idEjecutivoCuenta},
        #{idResponsableProyecto},
        #{nombreProyecto},
        #{alcanceInicial},
        #{ObjetivoInicial},
        #{estado},
        #{idEmpresa}) 
        <!-- <selectKey keyProperty="codigoProyecto" resultType="String" order="AFTER">
            select "CODIGO_PROYECTO"
        </selectKey> -->
    </insert>
    
    <insert id="grabarDetalleEstadoProyectoByEstado" parameterType="DetalleEstadoProyecto">
        insert into "CREAR_PROYECTO"."DETALLE_ESTADO_PROYECTO" 
        ("ID_DETALLE_ESTADO_PROYECTO", 
        "ID_ESTADO_PROYECTO",
        "ID_PROYECTO",
        "FECHA_CREACION",
        "ESTADO")
        values
        (nextval('"CREAR_PROYECTO".sq_detalle_estado_proyecto'),  
        #{idEstadoProyecto},
        #{idProyecto},
        #{fechaCreacion},
        #{estado});
    </insert>
    
    <insert id="actualizarDetalleEstadoProyecto" parameterType="DetalleEstadoProyecto">
        update "CREAR_PROYECTO"."DETALLE_ESTADO_PROYECTO" 
        set "FECHA_CREACION" = #{fechaCreacion},
        	"ESTADO" = #{estado}
        where "ID_DETALLE_ESTADO_PROYECTO" = #{idDetalleEstadoProyecto};
    </insert>
    
    <select id="buscarByIdPyByEstPyByEst" parameterType = "AgregarAnteproyectoModel" resultType="DetalleEstadoProyecto">
       select detEstPy."ID_DETALLE_ESTADO_PROYECTO" as idDetalleEstadoProyecto,
       		  detEstPy."ESTADO" as estado
       from "CREAR_PROYECTO"."DETALLE_ESTADO_PROYECTO" detEstPy
       where detEstPy."ESTADO" = #{estado}
            and detEstPy."ID_ESTADO_PROYECTO" = #{idEstadoProyecto}
            and detEstPy."ID_PROYECTO" = #{idProyecto}        
    </select>
    
    <select id="buscarPyByCodPy" parameterType = "java.lang.String" resultType="Proyecto">
       select py."ID_PROYECTO" as idProyecto
       from "CREAR_PROYECTO"."PROYECTO" py
       where py."CODIGO_PROYECTO" = #{codigoPy}   
    </select>
    
    <select id="buscarPyByIdPy" parameterType = "java.lang.Long" resultType="Proyecto">
       select py."CODIGO_PROYECTO" as codigoProyecto,
       			py."ID_TIPO_PROYECTO" as idTipoProyecto,
       			py."DESCRIPCION_PRODUCTO_PROYECTO" as descripcionProductoProyecto,
       			py."ALCANCE_PROYECTO" as alcanceProyecto, 
                py."NOMBRE_PROYECTO" as nombreProyecto
       from "CREAR_PROYECTO"."PROYECTO" py
       where py."ID_PROYECTO" = #{idPy}   
    </select>
    
    <insert id="actualizarProyectoByEstado" parameterType="Proyecto">     
        update "CREAR_PROYECTO"."PROYECTO" 
        set "ID_PROYECTO_ASOCIADO" = #{idProyectoAsociado},
        "FECHA_CONTACTO" = #{fechaContacto}, 
        "ID_TIPO_PROYECTO" = #{idTipoProyecto},
        "ID_EJECUTIVO_CUENTA" = #{idEjecutivoCuenta},
        "ID_RESPONSABLE_PROYECTO" = #{idResponsableProyecto},
        "NOMBRE_PROYECTO" = #{nombreProyecto},
        "ALCANCE_INICIAL" = #{alcanceInicial},
        "OBJETIVO_INICIAL" = #{ObjetivoInicial},
        "ESTADO" = #{estado},
        "ID_EMPRESA" = #{idEmpresa} 
        where "ID_PROYECTO" = #{idProyecto}
            
    </insert>
    
    <delete id="eliminarDetalleInteresado" parameterType="AgregarAnteproyectoModel">
      delete from "CREAR_PROYECTO"."DETALLE_INTERESADO" 
      where "ID_PROYECTO" = #{idProyecto};
    </delete>
    
    <insert id="insertarListaDetalleInteresado" parameterType="java.util.List">        
        <foreach collection="interesados" item="element" index="index" separator="">
            INSERT INTO "CREAR_PROYECTO"."DETALLE_INTERESADO" (
            "ID_DETALLE_INTERESADO",
            "ID_DETALLE_EMPRESA_PERSONA",
            "ID_PROYECTO",
            "INTERES_CONTACTO",
            "ESTADO")
            VALUES
            (nextval('"CREAR_PROYECTO"."SQ_DETALLE_INTERESADO"'),  
            #{element.idInteresado},
            #{element.idProyecto},
            #{element.interes},
            1);
       </foreach>
    </insert>
    
    <delete id="eliminarDetalleArchivoByTipoArchivoByIdPy" parameterType="AgregarAnteproyectoModel">
      delete from "CREAR_PROYECTO"."DETALLE_ARCHIVO" 
      where "ID_PROYECTO" = #{idProyecto}
      and "ID_TIPO_ARCHIVO" = #{tipoArchivo};
    </delete>  
    
    <insert id="insertarListaDetalleObservaciones" parameterType="java.util.List">        
        <foreach collection="observaciones" item="element" index="index" separator="">
            INSERT INTO "CREAR_PROYECTO"."DETALLE_ARCHIVO" (
            "ID_DETALLE_ARCHIVO",
            "NOMBRE_ARCHIVO",
            "ID_PROYECTO",
            "ID_TIPO_ARCHIVO",
            "OBSERVACION",
            "ESTADO")
            VALUES
            (nextval('"CREAR_PROYECTO"."SQ_DETALLE_ARCHIVO"'),  
            #{element.archivo},
            #{element.idProyecto},
            #{element.idTipoArchivo},
            #{element.observacion},
            1);
       </foreach>
    </insert>  
    
    <insert id="insertarListaDetalleAnexo" parameterType="java.util.List">        
        <foreach collection="anexos" item="element" index="index" separator="">
            INSERT INTO "CREAR_PROYECTO"."DETALLE_ARCHIVO" (
            "ID_DETALLE_ARCHIVO",
            "NOMBRE_ARCHIVO",
            "ID_PROYECTO",
            "ID_TIPO_ARCHIVO",
            "OBSERVACION",
            "ESTADO")
            VALUES
            (nextval('"CREAR_PROYECTO"."SQ_DETALLE_ARCHIVO"'),  
            #{element.archivo},
            #{element.idProyecto},
            #{element.idTipoArchivo},
            #{element.anexo},
            1);
       </foreach>
    </insert>
	
	<!-- DATOS DEL PROYECTO PARA EDITAR -->
	<select id="buscarProyectoById"  parameterType="java.lang.Long" resultType="AgregarAnteproyectoModel">
		select py."ID_PROYECTO" as idProyecto,
			py."CODIGO_PROYECTO" as codigoPy,
			py."ID_PROYECTO_ASOCIADO" as idProyectoAsociado,
			TO_CHAR(py."FECHA_CONTACTO", 'dd/MM/yyyy') as fechaContacto,
			py."ID_TIPO_PROYECTO" as idTipoProyecto,
			py."ID_EJECUTIVO_CUENTA" as idEjecutivoCuenta,
			py."ID_RESPONSABLE_PROYECTO" as idResponsable,
			py."NOMBRE_PROYECTO" as tituloProyecto,
			py."ALCANCE_INICIAL" as alcanceInicialProyecto,
			py."OBJETIVO_INICIAL" as objetivo,
            py."ID_EMPRESA" as idEmpresa 
		from "CREAR_PROYECTO"."PROYECTO" py	
		where py."ID_PROYECTO" = #{idPy}		
	</select>
	
	<!-- LISTAR INTERESADO PARA EDITAR -->
	<select id="listarInteresadosByIdProyecto"  parameterType="java.lang.Long" resultType="InteresadoAnteproyectoModel">
		SELECT DETEMPPER."ID_DETALLE_EMPRESA_PERSONA" idInteresado,
			DETINT."INTERES_CONTACTO" interes,
			PER."NOMBRE_PERSONA"||' '||PER."APELLIDO_PERSONA" nombreInteresado,
			PER."EMAIL" correoInteresado,
			PER."ID_PERSONA" idPersona,
			ROL."NOMBRE_TIPOROL" cargo
		FROM "CREAR_PROYECTO"."DETALLE_INTERESADO" DETINT 
		INNER JOIN "CREAR_PROYECTO"."DETALLE_EMPRESA_PERSONA" DETEMPPER
		ON DETEMPPER."ID_DETALLE_EMPRESA_PERSONA" = DETINT."ID_DETALLE_EMPRESA_PERSONA"
		INNER JOIN "CREAR_PROYECTO"."PERSONA" PER
		ON PER."ID_PERSONA" = DETEMPPER."ID_PERSONA"
		INNER JOIN "PLANIFICAR_PROYECTO"."TIPO_ROL" ROL
		ON ROL."ID_TIPO_ROL" = PER."ID_TIPO_ROL"
		WHERE DETINT."ID_PROYECTO" = #{idPy}	
	</select>
	
	<!-- LISTAR ARCHIVOS OBSERVACIONES PARA EDITAR -->
	<select id="listarObservacionesByIdProyecto"  parameterType="map" resultType="ObservacionesAnteproyectoModel">
		SELECT DETARC."OBSERVACION" observacion, 
			DETARC."NOMBRE_ARCHIVO" archivo
		FROM "CREAR_PROYECTO"."DETALLE_ARCHIVO" DETARC
		WHERE DETARC."ID_PROYECTO" = #{idPy}
		AND DETARC."ID_TIPO_ARCHIVO" = #{idTipoArch}	
	</select>
	
	<!-- LISTAR ARCHIVOS ANEXOS PARA EDITAR -->
	<select id="listarAnexosByIdProyecto"  parameterType="map" resultType="AnexosAnteproyectoModel">
		SELECT DETARC."OBSERVACION" anexo, 
			DETARC."NOMBRE_ARCHIVO" archivo
		FROM "CREAR_PROYECTO"."DETALLE_ARCHIVO" DETARC
		WHERE DETARC."ID_PROYECTO" = #{idPy}
		AND DETARC."ID_TIPO_ARCHIVO" = #{idTipoArch}	
	</select>		
	
	<!-- BUSCAR DETALLE PROYECTO USER ROL -->
	<select id="listarDetPyUserRolByPyByUserRol"  parameterType="DetProyectoUserRolModel" resultType="DetProyectoUserRolModel">
		SELECT DETPYUSER."id_detalle_proyecto_user" idDetProyectoUser
		FROM "CREAR_PROYECTO"."DETALLE_PROYECTO_USER_ROL" DETPYUSER
		WHERE DETPYUSER."ID_PROYECTO" = #{idProyecto}
		AND DETPYUSER."ID_USER_ROL" = #{idUserRol}	
	</select>	
	
	<!-- INSERTAR TABLA DETALLE PROYECTO USER ROL -->
	<insert id="grabarDetPyUserRol" parameterType="DetProyectoUserRolModel">
        <selectKey keyProperty="idDetProyectoUser" resultType="Long" order="BEFORE">
            select NEXTVAL('"CREAR_PROYECTO"."SQ_DETALLE_PROYECTO_USER_ROL"')
        </selectKey>
        insert into "CREAR_PROYECTO"."DETALLE_PROYECTO_USER_ROL" 
        ("id_detalle_proyecto_user",
        "ID_PROYECTO",
        "ID_USER_ROL",        
        "ESTADO")
        values
        (#{idDetProyectoUser},
        #{idProyecto}, 
        #{idUserRol},        
        #{estado})  
    </insert>
    				
	<!-- FIN - PROYECTO -->
	
	<!-- INI - PLANIFICACION -->
    <insert id="actualizarProyectoByIdPy" parameterType="AgregarPlanificacionModel">
        update "CREAR_PROYECTO"."PROYECTO" 
        set 
        <if test="descripcionProducto != null and descripcionProducto != ''">
            "DESCRIPCION_PRODUCTO_PROYECTO" = #{descripcionProducto}
        </if>
        <if test="descripcionProducto != null and descripcionProducto != '' and definicionAlcance != null and definicionAlcance != ''">
            , 
        </if>
        <if test="definicionAlcance != null and definicionAlcance != ''">
            "ALCANCE_PROYECTO" = #{definicionAlcance} 
        </if>     
        where "ID_PROYECTO" = #{idProyecto};
    </insert>
    
    <select id="listarTipoRequisitoProyectoByIdTipoPy" parameterType="Long" resultType="tipoReqProyectoModel">
	   select  tr."ID_TIPO_REQUISITO" as id, 
	   		   tr."DESCRIPCION_TIPO_REQUISITO" as descripcion			   
	   from "PLANIFICAR_PROYECTO"."TIPO_REQUISITO" tr
	   inner join "CREAR_PROYECTO"."TIPO_PROYECTO" tp
	   on tp."ID_TIPO_PROYECTO" = tr."ID_TIPO_PROYECTO"
	   where tr."ID_TIPO_PROYECTO" = #{idTipoPy};
	</select>
	
	
	<select id="listarTipoSupuestoProyectoByIdTipoPy" parameterType="Long" resultType="tipoSupProyectoModel">
	   SELECT ts."ID_TIPO_SUPUESTO" id, 
	       ts."DESCRIPCION" descripcion 	       
	  FROM "PLANIFICAR_PROYECTO"."TIPO_SUPUESTO" ts
	  inner join "CREAR_PROYECTO"."TIPO_PROYECTO" tp
	  on ts."ID_TIPO_PROYECTO" = tp."ID_TIPO_PROYECTO"
	  where ts."ID_TIPO_PROYECTO" = #{idTipoPy};
	</select>
	
	<select id="listarTipoDependenciaProyectoByIdTipoPy" parameterType="Long" resultType="tipoDepProyectoModel">
	   SELECT td."ID_TIPO_DEPENDENCIA" id, 
	       td."DESCRIPCION_TIPO_DEPENDENCIA" descripcion
	  FROM "PLANIFICAR_PROYECTO"."TIPO_DEPENDENCIA" td
	  inner join "CREAR_PROYECTO"."TIPO_PROYECTO" tp
	  on td."ID_TIPO_PROYECTO" = tp."ID_TIPO_PROYECTO"
	  where td."ID_TIPO_PROYECTO" = #{idTipoPy};
	</select>
	
	<insert id="insertarListaDetalleTipoRequisito" parameterType="java.util.List">        
        <foreach collection="tipoRequisitos" item="element" index="index" separator="">
            INSERT INTO "PLANIFICAR_PROYECTO"."DETALLE_REQUISITO_PROYECTO" (
            "ID_DETALLE_REQUISITO_PROYECTO",
            "ID_TIPO_REQUISITO",
            "ID_PROYECTO",
            "DESCRIPCION",
            "OBSERVACION")
            VALUES
            (nextval('"PLANIFICAR_PROYECTO"."SQ_DETALLE_REQUISITO_PROYECTO"'),  
            #{element.idTipoRequisito},
            #{element.idProyecto},
            #{element.descripcion},
            #{element.observacion});
       </foreach>
    </insert>
    
    <insert id="insertarListaDetalleExclusion" parameterType="java.util.List">        
        <foreach collection="exclusion" item="element" index="index" separator="">
            INSERT INTO "PLANIFICAR_PROYECTO"."DETALLE_EXCLUSION" (
            "ID_DETALLE_EXCLUSION",
            "ID_PROYECTO",
            "DESCRIPCION",
            "ESTADO")
            VALUES
            (nextval('"PLANIFICAR_PROYECTO"."SQ_DETALLE_EXCLUSION"'),  
            #{element.idProyecto},
            #{element.descripcion},
            1);
       </foreach>
    </insert>
    
    <insert id="insertarListaDetalleSupuesto" parameterType="java.util.List">        
        <foreach collection="supuesto" item="element" index="index" separator="">
            INSERT INTO "PLANIFICAR_PROYECTO"."DETALLE_SUPUESTO_PROYECTO" (
            "ID_DETALLE_SUPUESTO_PROYECTO",
            "ID_TIPO_SUPUESTO",
            "ID_PROYECTO",
            "DESCRIPCION",
            "ESTADO")
            VALUES
            (nextval('"PLANIFICAR_PROYECTO"."SQ_DETALLE_SUPUESTO_PROYECTO"'),  
            #{element.idTipoSupuesto},
            #{element.idProyecto},
            #{element.descripcion},
            1);
       </foreach>
    </insert>
    
    <insert id="insertarListaDetalleDependencia" parameterType="java.util.List">        
        <foreach collection="dependencia" item="element" index="index" separator="">
            INSERT INTO "PLANIFICAR_PROYECTO"."DETALLE_DEPENDENCIA_PROYECTO" (
            "ID_DETALLE_DEPENDENCIA_PROYECTO",
            "ID_TIPO_DEPENDENCIA",
            "ID_PROYECTO",
            "DESCRIPCION_DEPENDENCIA",
            "ESTADO")
            VALUES
            (nextval('"PLANIFICAR_PROYECTO"."SQ_DETALLE_DEPENDENCIA_PROYECTO"'),  
            #{element.idTipoDependencia},
            #{element.idProyecto},
            #{element.descripcion},
            1);
       </foreach>
    </insert>
    
    <insert id="insertarListaDetalleFactorExito" parameterType="java.util.List">        
        <foreach collection="factorExito" item="element" index="index" separator="">
            INSERT INTO "PLANIFICAR_PROYECTO"."DETALLE_FACTOR_EXITO" (
            "ID_DETALLE_FACTOR_EXITO",
            "ID_PROYECTO",
            "DESCRIPCION_FACTOR_EXITO",
            "ESTADO")
            VALUES
            (nextval('"PLANIFICAR_PROYECTO"."SQ_DETALLE_FACTOR_EXITO"'),  
            #{element.idProyecto},
            #{element.descripcion},
            1);
       </foreach>
    </insert>
	
	<select id="listarFormasPago" resultType="tipoFormaPago">
	   SELECT "ID_TIPO_FORMA_PAGO" as id, 
				"DESCRIPCION" as descripcion
  		FROM "PLANIFICAR_PROYECTO"."TIPO_FORMA_PAGO"
  		WHERE "ESTADO" = 1;
	</select>
	
	<select id="listarEntregablesProyectoId" parameterType="long" resultType="entregable">
		SELECT DISTINCT general."ID_ENTREGABLE" as identregable, 
					   general."NOMBRE_ENTREGABLE" as nombre,
					   general."DESCRIPCION_ENTREGABLE" descripcion, 
				       to_char(general."FECHA_PROGRAMADA", 'DD/MM/YYYY') fechaProgramada, 
				       general."ESTADO" estado, 
				       general."ID_ESTADO_ENTREGABLE" idestadoEntregable, 
				       to_char(general."FECHA_ENVIO", 'DD/MM/YYYY') fechaEnvio, 
				       to_char(general."FECHA_APROBACION", 'DD/MM/YYYY') fechaAprobacion 
  		FROM "PLANIFICAR_PROYECTO"."ENTREGABLE" general 
  		inner join "PLANIFICAR_PROYECTO"."DETALLE_ENTREGABLE_PRODUCTO" detalle
  		on detalle."ID_ENTREGABLE" = general."ID_ENTREGABLE"
  		WHERE detalle."ID_PROYECTO" = #{idProyecto}
  		and general."ESTADO"  = 1;
	</select>
	
	<insert id="guardarFormaPago" parameterType="formasPagoModel">
        <selectKey keyProperty="idFormaPagoDetal" resultType="Long" order="BEFORE">
            select NEXTVAL('"PLANIFICAR_PROYECTO".sq_detalle_forma_pago_proyecto')
        </selectKey>
        INSERT INTO "PLANIFICAR_PROYECTO"."DETALLE_FORMA_PAGO_PROYECTO"(
            "ID_DETALLE_FORMA_PAGO_PROYECTO", 
            "ID_ENTREGABLE", 
            "ID_FORMA_PAGO", 
            "NUMERO_CUOTA", 
            "FECHA_FACTURACION", 
            "FECHA_COBRANZA", 
            "PORCENTAJE_PAGO", 
            "ESTADO",
            "ID_PROYECTO")    	
        values(
        	#{idFormaPagoDetal},
        	#{idEntregable}, 
        	#{idFormaPago},        
        	#{idFormaPagoDetal},
        	to_date(#{fechaFacturacion}, 'DD/MM/YYYY'),
        	to_date(#{fechaCobranza}, 'DD/MM/YYYY'),        	
        	#{porcentajePago},
        	#{estado},
        	#{idProyecto}
        	);  
    </insert>
    
    <delete id="eliminarFormaPago" parameterType="formasPagoModel">      
       DELETE FROM "PLANIFICAR_PROYECTO"."DETALLE_FORMA_PAGO_PROYECTO"
 		WHERE "ID_DETALLE_FORMA_PAGO_PROYECTO" = #{idFormaPagoDetal} ;
    </delete>
    
    <select id="listarFormaPagoIdProyecto" parameterType= "java.lang.Long" resultType="formasPagoModel">
		SELECT "ID_DETALLE_FORMA_PAGO_PROYECTO" as idFormaPagoDetal, 
			pago."ID_ENTREGABLE" as idEntregable,
			general."NOMBRE_ENTREGABLE" as descripcionEntregable, 
			"ID_FORMA_PAGO" as idFormaPago, 
			forma."DESCRIPCION" as descripcionFormaPago, 
       		"NUMERO_CUOTA" as nroCuota, 
       		to_char("FECHA_FACTURACION",'dd/MM/yyyy') as fechaFacturacion, 
       		to_char("FECHA_COBRANZA",'dd/MM/yyyy') as fechaCobranza, 
       		"PORCENTAJE_PAGO" as porcentajePago, 
       		pago."ESTADO" as estado,
       		"ID_PROYECTO" idProyecto
		 FROM "PLANIFICAR_PROYECTO"."DETALLE_FORMA_PAGO_PROYECTO" pago,
			"PLANIFICAR_PROYECTO"."TIPO_FORMA_PAGO" forma,
			"PLANIFICAR_PROYECTO"."ENTREGABLE" general 
			where forma."ID_TIPO_FORMA_PAGO" = pago."ID_FORMA_PAGO"
			and general."ID_ENTREGABLE" = pago."ID_ENTREGABLE"
			and pago."ID_PROYECTO" = #{idProyecto};
	</select>
	
	<insert id="guardarDetalleCostoOperativo" parameterType="detalleCostoOperativoModel">
        <selectKey keyProperty="idCostoOperativo" resultType="Long" order="BEFORE">
            select NEXTVAL('"PLANIFICAR_PROYECTO".sq_detalle_costo_operativo_proyecto')
        </selectKey>
        INSERT INTO "PLANIFICAR_PROYECTO"."DETALLE_COSTO_OPERATIVO_PROYECTO"(
            "ID_DETALLE_COSTO_OPERATIVO_PROYECTO", 
            "ID_PROYECTO", 
            "ID_COSTO_OPERATIVO", 
            "DESCRIPCION", 
            "FECHA", 
            "MONTO", 
            "ESTADO")   	
        values(
        	#{idCostoOperativo},
        	#{idProyecto}, 
        	#{idTipoCosto},        
        	#{descripcionCosto},
        	to_date(#{fecha}, 'DD/MM/YYYY'),        	
        	#{monto},
        	#{estado}
        	);  
    </insert>
    
    <delete id="eliminarDetalleCostoOperativo" parameterType="detalleCostoOperativoModel">      
       DELETE FROM "PLANIFICAR_PROYECTO"."DETALLE_COSTO_OPERATIVO_PROYECTO"
 		WHERE "ID_DETALLE_COSTO_OPERATIVO_PROYECTO" = #{idCostoOperativo} ;
    </delete>
    
    <select id="listarDetalleCostoOperativoIdProyecto" parameterType= "java.lang.Long" resultType="detalleCostoOperativoModel">
		SELECT "ID_DETALLE_COSTO_OPERATIVO_PROYECTO" as idCostoOperativo, 
				"ID_PROYECTO" as idProyecto, 
				"ID_COSTO_OPERATIVO" as idTipoCosto,
				(select "DESCRIPCION" from "PLANIFICAR_PROYECTO"."TIPO_COSTO_OPERATIVO" 
						where "ID_TIPO_COSTO_OPERATIVO" = "ID_COSTO_OPERATIVO") as valTipoCosto, 
       			"DESCRIPCION" as descripcionCosto, 
       			to_char("FECHA", 'DD/MM/YYYY') as fecha, 
       			"MONTO" as monto, 
       			"ESTADO" as estado
  			FROM "PLANIFICAR_PROYECTO"."DETALLE_COSTO_OPERATIVO_PROYECTO"			
			WHERE "ID_PROYECTO" = #{idProyecto};
	</select>
	
	<insert id="guardarDetalleRiesgos" parameterType="detalleRiesgosModel">
        <selectKey keyProperty="idDetalleRiesgos" resultType="Long" order="BEFORE">
            select NEXTVAL('"PLANIFICAR_PROYECTO".sq_detalle_riesgos_proyecto')
        </selectKey>
        INSERT INTO "PLANIFICAR_PROYECTO"."DETALLE_RIESGOS_PROYECTO"(
            "ID_DETALLE_RIESGOS_PROYECTO", 
            "ID_PROYECTO", 
            "RIESGO", 
            "RESPONSABLE", 
            "IMPACTO", 
            "PROBABILIDAD", 
            "CONTINGENCIA", 
            "MITGACION", 
            "ESTADO")    	
        values(
        	#{idDetalleRiesgos},
        	#{idProyecto}, 
        	#{valRiesgo},        
        	#{valResponsable},
        	#{valImpacto},
        	#{valProbabilidad},        	
        	#{valContigencia},
        	#{valMitigacion},
        	#{estado}
        	);  
    </insert>
    
    <delete id="eliminarDetalleRiesgos" parameterType="detalleRiesgosModel">      
       DELETE FROM "PLANIFICAR_PROYECTO"."DETALLE_RIESGOS_PROYECTO"
 		WHERE  "ID_DETALLE_RIESGOS_PROYECTO" = #{idDetalleRiesgos} ;
    </delete>
    
    <insert id="guardarDetalleRolProyecto" parameterType="detalleRolProyecto">
        <selectKey keyProperty="id" resultType="Long" order="BEFORE">
            select NEXTVAL('"PLANIFICAR_PROYECTO".sq_detalle_rol_proyecto')
        </selectKey>
        INSERT INTO "PLANIFICAR_PROYECTO"."DETALLE_ROL_PROYECTO"(
            "ID_DETALLE_ROL_PROYECTO", 
            "ID_PROYECTO", 
            "ID_TIPO_ROL", 
            "CANTIDAD", 
            "ESTADO")     
        values(
            #{id},
            #{idProyecto}, 
            #{idtiporol},        
            #{cantidad},
            #{estado}
            );  
    </insert>
    
    <insert id="guardarDetalleCostoProyecto" parameterType="detalleCostoProyecto">
        <selectKey keyProperty="idDetalleCostoProyecto" resultType="Long" order="BEFORE">
            select NEXTVAL('"PLANIFICAR_PROYECTO".sq_detalle_costo_proyecto')
        </selectKey>
        INSERT INTO "PLANIFICAR_PROYECTO"."DETALLE_COSTO_PROYECTO"(
            "ID_DETALLE_COSTO_PROYECTO", 
            "ID_DETALLE_ROL_PROYECTO",
            "ID_PROYECTO",
            "ESTADO")     
        values(
            #{idDetalleCostoProyecto},
            #{idDetalleRolProyecto},
            #{idProyecto},
            #{estado}
            );  
    </insert>
    
    <delete id="eliminarDetalleRolProyecto" parameterType="detalleRolProyecto">      
       DELETE FROM "PLANIFICAR_PROYECTO"."DETALLE_ROL_PROYECTO"
        WHERE "ID_DETALLE_ROL_PROYECTO" = #{id} ;
    </delete>
    
    <delete id="eliminarDetalleCostoProyecto" parameterType="detalleCostoProyecto">      
       DELETE FROM "PLANIFICAR_PROYECTO"."DETALLE_COSTO_PROYECTO"
        WHERE "ID_DETALLE_ROL_PROYECTO" = #{idDetalleRolProyecto} ;
    </delete>
    
    <select id="listarDetalleRolProyectoByIdProyectoByTipoRol" parameterType= "Map" resultType="detalleRolProyecto">
        SELECT DETROLPY."ID_DETALLE_ROL_PROYECTO" as id, 
            TIPOROL."NOMBRE_TIPOROL" as descripcion,
            DETROLPY."CANTIDAD" as cantidad,          
            DETROLPY."ID_PROYECTO" as idProyecto
         FROM "PLANIFICAR_PROYECTO"."DETALLE_ROL_PROYECTO" DETROLPY
         INNER JOIN "PLANIFICAR_PROYECTO"."TIPO_ROL" TIPOROL
         ON DETROLPY."ID_TIPO_ROL" = TIPOROL."ID_TIPO_ROL"
         where DETROLPY."ID_PROYECTO" = #{idProyecto}
                and TIPOROL."TIPO_ROL" = #{tipoRol};
    </select>
    
    <select id="listarDetalleRolProyectoByIdProyectoByTipoRolResponsabilidad" parameterType= "Map" resultType="detalleRolProyecto">
         SELECT DETROLPY."ID_DETALLE_ROL_PROYECTO" as id, 
            TIPOROL."NOMBRE_TIPOROL" as descripcion,
            DETROLPY."CANTIDAD" as cantidad,          
            DETROLPY."ID_PROYECTO" as idProyecto,
            CASE WHEN DETROLPY."DESCRIPCION" IS NOT NULL THEN DETROLPY."DESCRIPCION"            
            	ELSE TIPOROL."DESCRIPCION_ROL"
	        END as descripcionDetalleRol             
         FROM "PLANIFICAR_PROYECTO"."DETALLE_ROL_PROYECTO" DETROLPY
         INNER JOIN "PLANIFICAR_PROYECTO"."TIPO_ROL" TIPOROL
         ON DETROLPY."ID_TIPO_ROL" = TIPOROL."ID_TIPO_ROL"
         where DETROLPY."ID_PROYECTO" = #{idProyecto}
         		and TIPOROL."TIPO_ROL" = #{tipoRol};              
    </select>
    
    <select id="listarDetalleRiesgosIdProyecto" parameterType= "java.lang.Long" resultType="detalleRiesgosModel">
		SELECT "ID_DETALLE_RIESGOS_PROYECTO" as idDetalleRiesgos, 
				"ID_PROYECTO" as idProyecto, 
				"RIESGO" as valRiesgo, 
				"RESPONSABLE" as valResponsable, 
       			"IMPACTO" as valImpacto, 
       			"PROBABILIDAD" as valProbabilidad, 
       			"CONTINGENCIA" as valContigencia, 
       			"MITGACION" as valMitigacion, 
       			"ESTADO" as estado
  		FROM "PLANIFICAR_PROYECTO"."DETALLE_RIESGOS_PROYECTO"
  		WHERE "ID_PROYECTO" = #{idProyecto};			
	</select>
	
	<select id="listarDetalleAdquisicionIdProyecto" parameterType= "java.lang.Long" resultType="detalleAdquisicionProyecto">
        SELECT dap."ID_DETALLE_ADQUISICION_PROYECTO" id, 
               dap."ID_PROYECTO" idproyecto, 
               dap."ID_CATEGORIA_ADQUISICION" idcatadquisicion, 
               (SELECT "DESCRIPCION"
                FROM "PLANIFICAR_PROYECTO"."CATEGORIA_ADQUISICION" ca
                WHERE ca."ID_CATEGORIA_ADQUISICION" = dap."ID_CATEGORIA_ADQUISICION") categoriaDescripcion,
               dap."PRODUCTO" producto, 
               dap."CANTIDAD" cantidad, 
               dap."COSTO_UNITARIO" costoUnitario, 
               to_char(dap."FECHA_ADQUISICION", 'DD/MM/YYYY') fechaAdquisicion, 
               dap."ESTADO" estado, 
               dap."ID_ESTADO_ADQUISICION" idestadoadquisicion,              
               dap."ID_PERSONA" idResponsable            
        FROM "PLANIFICAR_PROYECTO"."DETALLE_ADQUISICION_PROYECTO" dap           
        WHERE dap."ID_PROYECTO" = #{idProyecto};                  
    </select>
	
	<!-- LISTAR TIPO REQUISITO PARA EDITAR -->
    <select id="listarTipoRequisitoByIdProyecto"  parameterType="java.lang.Long" resultType="RequisitoProyectoPlanificacionModel">
        SELECT TIPOREQ."ID_TIPO_REQUISITO" idTipoRequisito, 
            TIPOREQ."DESCRIPCION_TIPO_REQUISITO" descTipoRequisito,
            DETTIPREQ."DESCRIPCION" descripcion,
            DETTIPREQ."OBSERVACION" observacion
        FROM "PLANIFICAR_PROYECTO"."DETALLE_REQUISITO_PROYECTO" DETTIPREQ 
        INNER JOIN "PLANIFICAR_PROYECTO"."TIPO_REQUISITO" TIPOREQ
        ON DETTIPREQ."ID_TIPO_REQUISITO" = TIPOREQ."ID_TIPO_REQUISITO"
        WHERE DETTIPREQ."ID_PROYECTO" = #{idPy}   
    </select>
    
    <!-- LISTAR EXCLUSION PARA EDITAR -->
    <select id="listarExclusionByIdProyecto"  parameterType="java.lang.Long" resultType="ExclusionPlanificacionModel">
        SELECT DETEXCLU."DESCRIPCION" descripcion
        FROM "PLANIFICAR_PROYECTO"."DETALLE_EXCLUSION" DETEXCLU  
        WHERE DETEXCLU."ID_PROYECTO" = #{idPy}    
    </select>
    
    <!-- LISTAR SUPUESTO PARA EDITAR -->
    <select id="listarSupuestoByIdProyecto"  parameterType="java.lang.Long" resultType="SupuestoPlanificacionModel">
        SELECT TIPOSUP."ID_TIPO_SUPUESTO" idTipoSupuesto, 
            TIPOSUP."DESCRIPCION" descTipoSupuesto,
            DETSUP."DESCRIPCION" descripcion
        FROM "PLANIFICAR_PROYECTO"."DETALLE_SUPUESTO_PROYECTO" DETSUP 
        INNER JOIN "PLANIFICAR_PROYECTO"."TIPO_SUPUESTO" TIPOSUP
        ON DETSUP."ID_TIPO_SUPUESTO" = TIPOSUP."ID_TIPO_SUPUESTO"
        WHERE DETSUP."ID_PROYECTO" = #{idPy}  
    </select>
    
    <!-- LISTAR DEPENDENCIA PARA EDITAR -->
    <select id="listarDependenciaByIdProyecto"  parameterType="java.lang.Long" resultType="DependenciaPlanificacionModel">
        SELECT TIPODEP."ID_TIPO_DEPENDENCIA" idTipoDependencia, 
            TIPODEP."DESCRIPCION_TIPO_DEPENDENCIA" descTipoDepedencia,
            DETDEP."DESCRIPCION_DEPENDENCIA" descripcion
        FROM "PLANIFICAR_PROYECTO"."DETALLE_DEPENDENCIA_PROYECTO" DETDEP 
        INNER JOIN "PLANIFICAR_PROYECTO"."TIPO_DEPENDENCIA" TIPODEP
        ON DETDEP."ID_TIPO_DEPENDENCIA" = TIPODEP."ID_TIPO_DEPENDENCIA"
        WHERE DETDEP."ID_PROYECTO" = #{idPy}  
    </select>
    
    <!-- LISTAR FACTOR CRITICO PARA EDITAR -->
    <select id="listarFactorCriticoByIdProyecto"  parameterType="java.lang.Long" resultType="FactorExitoPlanificacionModel">
        SELECT DETFACCRI."DESCRIPCION_FACTOR_EXITO" descripcion
        FROM "PLANIFICAR_PROYECTO"."DETALLE_FACTOR_EXITO" DETFACCRI 
        WHERE DETFACCRI."ID_PROYECTO" = #{idPy}   
    </select>
    
    <delete id="eliminarDetalleTipoRequisitoByIdPy" parameterType="Long">
      delete FROM "PLANIFICAR_PROYECTO"."DETALLE_REQUISITO_PROYECTO" DETTIPREQ 
      where "ID_PROYECTO" = #{idPy};
    </delete>
    
    <delete id="eliminarDetalleExclusionByIdPy" parameterType="Long">
      delete FROM "PLANIFICAR_PROYECTO"."DETALLE_EXCLUSION" DETEXCLU 
      where "ID_PROYECTO" = #{idPy};
    </delete>
    
    <delete id="eliminarDetalleSupuestoByIdPy" parameterType="Long">
      delete FROM "PLANIFICAR_PROYECTO"."DETALLE_SUPUESTO_PROYECTO" DETSUP 
      where "ID_PROYECTO" = #{idPy};
    </delete>
    
    <delete id="eliminarDetalleDependenciaByIdPy" parameterType="Long">
      delete FROM "PLANIFICAR_PROYECTO"."DETALLE_DEPENDENCIA_PROYECTO" DETDEP 
      where "ID_PROYECTO" = #{idPy};
    </delete>
    
    <delete id="eliminarDetalleFactorCriticoByIdPy" parameterType="Long">
      delete FROM "PLANIFICAR_PROYECTO"."DETALLE_FACTOR_EXITO" DETFACCRI 
      where "ID_PROYECTO" = #{idPy};
    </delete>     
    
    <select id="listarTipoRolByTipoRol" parameterType="int" resultType="tipoRol">
        SELECT "ID_TIPO_ROL" as id, 
                "NOMBRE_TIPOROL" as nombreRol
          FROM "PLANIFICAR_PROYECTO"."TIPO_ROL" 
        WHERE "TIPO_ROL" = #{tipoRol};
    </select>  	
    
    <insert id="actualizarDescripcionTipoRol" parameterType="DetalleEstadoProyecto">
        update "PLANIFICAR_PROYECTO"."DETALLE_ROL_PROYECTO" 
        set "DESCRIPCION" = #{descripcionDetalleRol},
        	"ESTADO" = #{estado}
        where "ID_DETALLE_ROL_PROYECTO" = #{id};
    </insert>
    
    <select id="validacionejecutarproyecto" parameterType="Long" resultType="String">
		SELECT "PLANIFICAR_PROYECTO".validacionejecutarproyecto(#{idProyecto}::bigint);
	</select>    
	
	<insert id="actualizarDetalleEstadoProyectoByIdProyecto" parameterType="DetalleEstadoProyecto">
        update "CREAR_PROYECTO"."DETALLE_ESTADO_PROYECTO" 
        set "ESTADO" = #{estado}	
        where "ID_PROYECTO" = #{idProyecto};
    </insert>
    
	<insert id="ejecutarEjecucion" parameterType="Map">     
        insert into "CREAR_PROYECTO"."DETALLE_ESTADO_PROYECTO" 
        ("ID_DETALLE_ESTADO_PROYECTO", 
        "ID_ESTADO_PROYECTO",
        "ID_PROYECTO",
        "FECHA_CREACION",
        "FECHA_APROBACION",
        "ESTADO")
        values
        (nextval('"CREAR_PROYECTO".sq_detalle_estado_proyecto'),  
        #{idEstadoProyecto},
        #{idProyecto},
        #{fechaCreacion},
        #{fechaAprobacion},
        #{estado});            
    </insert>
    
    <select id="listarDetalleCostoProyectoByIdProyecto" parameterType="Long" resultType="detalleCostoProyecto">	
		SELECT DCP."ID_DETALLE_COSTO_PROYECTO" as idDetalleCostoProyecto, 
				DCP."ID_DETALLE_ROL_PROYECTO" as idDetalleRolProyecto,
				DCP."ID_BANDA_SALARIAL" as idBandaSalarial,
				DCP."COSTO" as costo,
				DCP."ID_TIPO_NIVEL" as idTipoNivel,
				DCP."ID_PROYECTO" as idProyecto,
				TIPOROL."NOMBRE_TIPOROL" as descripcionRol,				
				(SELECT BANDASALARIAL."DESCRIPCION" 
					FROM "PLANIFICAR_PROYECTO"."BANDA_SALARIAL" BANDASALARIAL
				WHERE BANDASALARIAL."ID_BANDA_SALARIAL" = (SELECT DISTINCT DETBANDASALARIAL."ID_BANDA_SALARIAL" 
										FROM "PLANIFICAR_PROYECTO"."DETALLE_BANDA_SALARIAL" DETBANDASALARIAL 
										WHERE DETBANDASALARIAL."ID_DETALLE_BANDA_SALARIAL" = DCP."ID_BANDA_SALARIAL")
				) as descripcionBandaSalarial,
				(SELECT TIPONIVEL."DESCRIPCION_TIPO_NIVEL" 
					FROM "PLANIFICAR_PROYECTO"."TIPO_NIVEL" TIPONIVEL
				WHERE TIPONIVEL."ID_TIPO_NIVEL" = DCP."ID_TIPO_NIVEL") as descripcionTipo
				FROM "PLANIFICAR_PROYECTO"."DETALLE_COSTO_PROYECTO" DCP
		  INNER JOIN "PLANIFICAR_PROYECTO"."DETALLE_ROL_PROYECTO" DETROLPY
		  ON DETROLPY."ID_DETALLE_ROL_PROYECTO" = DCP."ID_DETALLE_ROL_PROYECTO" 
		  INNER JOIN "PLANIFICAR_PROYECTO"."TIPO_ROL" TIPOROL
		  ON TIPOROL."ID_TIPO_ROL" = DETROLPY."ID_TIPO_ROL"
		WHERE DCP."ID_PROYECTO" = #{idProyecto};
	</select>		
	
	<select id="listarTipoNivel" parameterType="Map" resultType="tipoNivelModel">
		SELECT "ID_TIPO_NIVEL" as idTipoNivel, 
				"DESCRIPCION_TIPO_NIVEL" as descripcion,
				"ESTADO" as estado
		  FROM "PLANIFICAR_PROYECTO"."TIPO_NIVEL" 
		WHERE "ESTADO" = #{estado};
	</select>
	
	<select id="listarBandaSalarial" parameterType="Long" resultType="bandaSalarialModel">
		SELECT "ID_BANDA_SALARIAL" as idBandaSalarial, 
				"DESCRIPCION" as descripcion,
				"ID_TIPO_NIVEL" as idTipoNivel,
				"ESTADO" as estado
		  FROM "PLANIFICAR_PROYECTO"."BANDA_SALARIAL" 
		WHERE "ESTADO" = #{estado}
			AND "ID_TIPO_NIVEL" = #{idTipoNivel};
	</select>
	
	<select id="obtenerDetalleBandaSalarialByIdBandaSalarial" parameterType="Long" resultType="detalleBandaSalarialModel">
		SELECT "ID_DETALLE_BANDA_SALARIAL" as idDetalleBandaSalarial, 
				"COSTO_BANDA_SALARIAL" as costoBandaSalarial,
				"ID_TIPO_ROL" as idTipoRol,
				"ID_BANDA_SALARIAL" as idBandaSalarial,
				"ESTADO" as estado
		  FROM "PLANIFICAR_PROYECTO"."DETALLE_BANDA_SALARIAL" 
		WHERE "ESTADO" = #{estado}
			AND "ID_DETALLE_BANDA_SALARIAL" = #{idDetalleBandaSalarial};
	</select>
	
	<insert id="actualizarCostoProyectoByIdDetalleCostoProyecto" parameterType="detalleCostoProyecto">
        update "PLANIFICAR_PROYECTO"."DETALLE_COSTO_PROYECTO" 
        set "ID_BANDA_SALARIAL" = #{idBandaSalarial},
        	"COSTO" = #{costo},
        	"ID_TIPO_NIVEL" = #{idTipoNivel}
        where "ID_DETALLE_COSTO_PROYECTO" = #{idDetalleCostoProyecto};
    </insert>    
    
    <select id="obtenerCostosProyectoByIdProyecto" parameterType="Long" resultType="Long">
		select sum("COSTO") as costo
		from "PLANIFICAR_PROYECTO"."DETALLE_COSTO_PROYECTO"
		where "ID_PROYECTO" = #{idProyecto};
	</select>
    
    <!-- FIN - PLANIFICACION -->
    
	<!-- [INI] EJECUCION -->
	<select id="listarProyectoByEstado" parameterType="int" resultType="Proyecto">
		SELECT "ID_PROYECTO" as idProyecto, 
				"NOMBRE_PROYECTO" as nombreProyecto
		  FROM "CREAR_PROYECTO"."PROYECTO" 
		WHERE "ESTADO" = #{estado};
	</select>
	
	<select id="listaProyectoByEstadoEjecucion" resultType="LstProyEjecucion">
	   select p."ID_PROYECTO" as idProyecto, P."NOMBRE_PROYECTO" as dscProyecto , e."ID_EMPRESA" as idCliente, 
	   		  e."RAZON_SOCIAL" as dscCliente, tp."ID_TIPO_PROYECTO" as idTipoProyecto, tp."DESCRIPCION_TIPO_PROYECTO" as dscTipoProyecto, 
	   		  to_char(p."FECHA_CONTACTO", 'DD/MM/YYYY') as fechaInicio,
	   		    p."ID_RESPONSABLE_PROYECTO" as idResponsable,
			       (select per."NOMBRE_PERSONA" || per."APELLIDO_PERSONA" 
			        from seguridad.security_rol_user sru,
					      seguridad.security_user su,
					      "CREAR_PROYECTO"."PERSONA" per
			        where sru.id_user = su.id_user
			        and   su."ID_PERSONA" = per."ID_PERSONA"
			        and   sru.id_detalle = p."ID_RESPONSABLE_PROYECTO") as dscResponsable
			from "CREAR_PROYECTO"."DETALLE_ESTADO_PROYECTO" dp,
			     "CREAR_PROYECTO"."PROYECTO" p,
			     "CREAR_PROYECTO"."DETALLE_INTERESADO" di,
			     "CREAR_PROYECTO"."DETALLE_EMPRESA_PERSONA" dep,
			     "CREAR_PROYECTO"."TIPO_PROYECTO" tp,
			     "CREAR_PROYECTO"."EMPRESA" e
			where dp."ID_PROYECTO" = p."ID_PROYECTO"
			and   p."ID_TIPO_PROYECTO" = tp."ID_TIPO_PROYECTO"
			and   p."ID_PROYECTO" = di."ID_PROYECTO"
			and   di."ID_DETALLE_EMPRESA_PERSONA" = dep."ID_DETALLE_EMPRESA_PERSONA"
			and   dep."ID_EMPRESA" = e."ID_EMPRESA"
 		    and   p."ESTADO" = 1
 		    and   dp."ESTADO" = 1
		<if test="idProyecto != null and idProyecto != ''">
			and p."ID_PROYECTO" = #{idProyecto} 
		</if>
		<if test="idCliente != null and idCliente != ''">
			and e."ID_EMPRESA" = #{idCliente}
		</if>
		<if test="idTipoProyecto != null and idTipoProyecto != ''">
			and tp."ID_TIPO_PROYECTO" = #{idTipoProyecto} 
		</if>
<!-- 		<if test="idResponsableProyecto != null and idResponsableProyecto != ''"> -->
<!-- 			and py."ID_TIPO_PROYECTO" = #{idResponsableProyecto}  -->
<!-- 		</if> -->

		<if test="estado != null and estado != ''">
			and dp."ID_ESTADO_PROYECTO" = #{estado} 
		</if>
		<if test="fechaInicio != null and fechaInicio != ''">
			and to_char(p."FECHA_CONTACTO", 'dd/mm/yyyy') = #{fechaInicio} 
		</if>
		<if test="fechaFin != null and fechaFin != ''">
			and to_char(p."FECHA_CONTACTO", 'dd/mm/yyyy') = #{fechaFin} 
		</if>
	</select>
	<!-- [FIN] EJECUCION -->
	<!-- [INI] CIERRE -->
	<select id="listaProyectoByEstadoCierre" resultType="LstProyCierre">
	   select p."ID_PROYECTO" as idProyecto, P."NOMBRE_PROYECTO" as dscProyecto , e."ID_EMPRESA" as idCliente, 
	   		  e."RAZON_SOCIAL" as dscCliente, tp."ID_TIPO_PROYECTO" as idTipoProyecto, tp."DESCRIPCION_TIPO_PROYECTO" as dscTipoProyecto, 
	   		  to_char(p."FECHA_CONTACTO", 'DD/MM/YYYY') as fechaInicio,
	   		    p."ID_RESPONSABLE_PROYECTO" as idResponsable,
			       (select per."NOMBRE_PERSONA" || per."APELLIDO_PERSONA" 
			        from seguridad.security_rol_user sru,
					      seguridad.security_user su,
					      "CREAR_PROYECTO"."PERSONA" per
			        where sru.id_user = su.id_user
			        and   su."ID_PERSONA" = per."ID_PERSONA"
			        and   sru.id_detalle = p."ID_RESPONSABLE_PROYECTO") as dscResponsable,
			  (select e."DESCRIPCION_ESTADO_PROYECTO" from "CREAR_PROYECTO"."ESTADO_PROYECTO" e
			   where e."ID_ESTADO_PROYECTO" = dp."ID_ESTADO_PROYECTO") estado					        
			from "CREAR_PROYECTO"."DETALLE_ESTADO_PROYECTO" dp,
			     "CREAR_PROYECTO"."PROYECTO" p,
			     "CREAR_PROYECTO"."DETALLE_INTERESADO" di,
			     "CREAR_PROYECTO"."DETALLE_EMPRESA_PERSONA" dep,
			     "CREAR_PROYECTO"."TIPO_PROYECTO" tp,
			     "CREAR_PROYECTO"."EMPRESA" e
			where dp."ID_PROYECTO" = p."ID_PROYECTO"
			and   p."ID_TIPO_PROYECTO" = tp."ID_TIPO_PROYECTO"
			and   p."ID_PROYECTO" = di."ID_PROYECTO"
			and   di."ID_DETALLE_EMPRESA_PERSONA" = dep."ID_DETALLE_EMPRESA_PERSONA"
			and   dep."ID_EMPRESA" = e."ID_EMPRESA"
 		    and   p."ESTADO" = 1
 		    and   dp."ESTADO" = 1
	    <if test="idCliente != null and idCliente != ''">
			and e."ID_EMPRESA" = #{idCliente}
		</if>
		<if test="idTipoProyecto != null and idTipoProyecto != ''">
			and tp."ID_TIPO_PROYECTO" = #{idTipoProyecto} 
		</if>
		<if test="estado != null and estado != ''">
			and dp."ID_ESTADO_PROYECTO" = #{estado} 
		</if>
		<if test="fechaInicio != null and fechaInicio != ''">
			and to_char(p."FECHA_CONTACTO", 'dd/mm/yyyy') = #{fechaInicio} 
		</if>
		<if test="fechaFin != null and fechaFin != ''">
			and to_char(p."FECHA_CONTACTO", 'dd/mm/yyyy') = #{fechaFin} 
		</if>
	</select>
	
	<update id="actualizarProyecto" parameterType="Proyecto" >
		UPDATE "CREAR_PROYECTO"."PROYECTO"
		   SET "NOMBRE_PROYECTO" = COALESCE(#{nombreProyecto}, "NOMBRE_PROYECTO"), 
		       "ID_TIPO_PROYECTO" = COALESCE(#{idTipoProyecto}, "ID_TIPO_PROYECTO"), 
		       "ESTADO" = COALESCE(#{estado}, "ESTADO"), 
		       "FECHA_CONTACTO" = COALESCE(#{fechaContacto}, "FECHA_CONTACTO"), 
		       "ID_RESPONSABLE_PROYECTO" = COALESCE(#{idResponsableProyecto}, "ID_RESPONSABLE_PROYECTO"),  
		       "ID_EJECUTIVO_CUENTA" = COALESCE(#{idEjecutivoCuenta}, "ID_EJECUTIVO_CUENTA"), 
		       "CODIGO_PROYECTO" = COALESCE(#{codigoProyecto}, "CODIGO_PROYECTO"), 
		       "ID_PROYECTO_ASOCIADO" = COALESCE(#{idProyectoAsociado}, "ID_PROYECTO_ASOCIADO"), 
		       "ALCANCE_INICIAL" = COALESCE(#{alcanceInicial}, "ALCANCE_INICIAL"), 
		       "OBJETIVO_INICIAL" = COALESCE(#{ObjetivoInicial}, "OBJETIVO_INICIAL"), 
		       "ID_EMPRESA" = COALESCE(#{idEmpresa}, "ID_EMPRESA"), 
		       "NOMBRE_EMPRESA" = COALESCE(#{nombreEmpresa}, "NOMBRE_EMPRESA"), 
		       "DESCRIPCION_PRODUCTO_PROYECTO" = COALESCE(#{descripcionProductoProyecto}, "DESCRIPCION_PRODUCTO_PROYECTO"), 
		       "ALCANCE_PROYECTO" = COALESCE(#{alcanceProyecto}, "ALCANCE_PROYECTO"), 
		       "FECHA_CIERRE_PROYECTO" = COALESCE(#{fechaCierreProyecto}, "FECHA_CIERRE_PROYECTO"), 
		       "COMENTARIOS_CIERRE_PROYECTO" = COALESCE(#{comentariosCierreProyecto}, "COMENTARIOS_CIERRE_PROYECTO"), 
		       "FECHA_CANCELACION" = COALESCE(#{fechaCancelacion}, "FECHA_CANCELACION"), 
		       "JUSTIFICACION_CANCELACION" = COALESCE(#{justificacionCancelacion}, "JUSTIFICACION_CANCELACION")
		 WHERE "ID_PROYECTO" = #{idProyecto};
	</update>
	<insert id="registrarDetallleProyecto" parameterType="DetalleProyecto">
	   INSERT INTO "CREAR_PROYECTO"."DETALLE_ESTADO_PROYECTO"(
            "ID_DETALLE_ESTADO_PROYECTO", "ID_ESTADO_PROYECTO", "ID_PROYECTO", 
            "FECHA_CREACION", "FECHA_APROBACION", "ESTADO")
	    VALUES (nextval('"CREAR_PROYECTO".sq_detalle_estado_proyecto'), #{idEstado}, #{idProyecto}, 
	            CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 1);
	</insert>
	
	<update id="actualizarDetalleProyecto" parameterType="DetalleProyecto">
		UPDATE "CREAR_PROYECTO"."DETALLE_ESTADO_PROYECTO"
		   SET "ESTADO" = #{estado}
		 WHERE "ID_PROYECTO" =  #{idProyecto};
	</update>
	<!-- [FIN] CIERRE -->
	
	<!-- [INI] ENTREGABLE -->
	<insert id="insertarEntregable" parameterType="entregableModel">
	<selectKey keyProperty="idEntregableProyecto" resultType="Long" order="BEFORE">
            select nextval('"PLANIFICAR_PROYECTO".sq_entregable')
        </selectKey>
		INSERT INTO "PLANIFICAR_PROYECTO"."ENTREGABLE"("ID_ENTREGABLE", "NOMBRE_ENTREGABLE", "DESCRIPCION_ENTREGABLE","FECHA_PROGRAMADA", 
                                               "ESTADO", "ID_ESTADO_ENTREGABLE")
	    VALUES (#{idEntregableProyecto}, #{valorET}, #{valDescripcionET}, to_date(#{fechaProgramadaET}, 'DD/MM/YYYY'), 
	            1, #{idEstadoEntregable});
	</insert>
	
	<insert id="insertarDetalleEntregableProducto" parameterType="detalleEntregableProyecto">
		INSERT INTO "PLANIFICAR_PROYECTO"."DETALLE_ENTREGABLE_PRODUCTO"("ID_DETALLE_ENTREGABLE_PRODUCTO", "ID_PROYECTO", "ID_ENTREGABLE", 
            "PRODUCTO", "ESTADO")
	    VALUES (nextval('"PLANIFICAR_PROYECTO".sq_detalle_entregable_producto'), #{idproyecto}, #{identregable}, 
	            #{producto}, #{estado});
	</insert>
	
	<update id="actualizarEntregable" parameterType="entregableModel">
		UPDATE "PLANIFICAR_PROYECTO"."ENTREGABLE"
		   SET "NOMBRE_ENTREGABLE" = COALESCE(#{valorET}, "NOMBRE_ENTREGABLE"),
		       "DESCRIPCION_ENTREGABLE" = COALESCE(#{valDescripcionET}, "DESCRIPCION_ENTREGABLE"),
		       "FECHA_PROGRAMADA" = COALESCE(to_date(#{fechaProgramadaET}, 'DD/MM/YYYY'), "FECHA_PROGRAMADA")
		 WHERE "ID_ENTREGABLE" = #{idEntregableProyecto};		
	</update>
	
	<update id="actualizarDetalleEntregableProducto"  parameterType="detalleEntregableProyecto">
		UPDATE "PLANIFICAR_PROYECTO"."DETALLE_ENTREGABLE_PRODUCTO"
		   SET "PRODUCTO" = COALESCE(#{producto}, "PRODUCTO"),
		       "ESTADO" = COALESCE(#{estado}, "ESTADO")
		 WHERE "ID_DETALLE_ENTREGABLE_PRODUCTO" = #{id};
	</update>
	
	<select id="listardetalleEntregableProyecto" parameterType="int" resultType="detalleEntregableProyecto">
		SELECT dep."ID_DETALLE_ENTREGABLE_PRODUCTO" id, 
		       dep."ID_PROYECTO" idproyecto, 
		       dep."ID_ENTREGABLE" identregable, 
		       dep."PRODUCTO" producto, 
		       dep."ESTADO" estado
		  FROM "PLANIFICAR_PROYECTO"."DETALLE_ENTREGABLE_PRODUCTO" dep
		  WHERE dep."ID_ENTREGABLE" = #{identregable};
	</select>
	
	<delete id="eliminarDetalleEntregableProducto" parameterType="detalleEntregableProyecto">
		DELETE  FROM "PLANIFICAR_PROYECTO"."DETALLE_ENTREGABLE_PRODUCTO" dep
		WHERE dep."ID_DETALLE_ENTREGABLE_PRODUCTO" = #{id};
	</delete>
	
	<delete id="eliminarEntregable" parameterType="int">
		DELETE FROM "PLANIFICAR_PROYECTO"."ENTREGABLE"
		WHERE "ID_ENTREGABLE" = #{dato};
	</delete>
	
	<select id="buscarEntregableProyecto" parameterType="entregable" resultType="entregable">
		SELECT DISTINCT general."ID_ENTREGABLE" as identregable, 
					   general."NOMBRE_ENTREGABLE" as nombre,
					   general."DESCRIPCION_ENTREGABLE" descripcion, 
				       to_char(general."FECHA_PROGRAMADA", 'DD/MM/YYYY') fechaProgramada, 
				       general."ESTADO" estado, 
				       general."ID_ESTADO_ENTREGABLE" idestadoEntregable, 
				       to_char(general."FECHA_ENVIO", 'DD/MM/YYYY') fechaEnvio, 
				       to_char(general."FECHA_APROBACION", 'DD/MM/YYYY') fechaAprobacion 
  		FROM "PLANIFICAR_PROYECTO"."ENTREGABLE" general 
  		inner join "PLANIFICAR_PROYECTO"."DETALLE_ENTREGABLE_PRODUCTO" detalle
  		on detalle."ID_ENTREGABLE" = general."ID_ENTREGABLE"
  		WHERE detalle."ID_PROYECTO" = #{idProyecto}
  		AND general."ID_ENTREGABLE" = #{identregable}
  		and general."ESTADO"  = 1;
	</select>
	
	<select id="listarProductoEntregable" parameterType="entregable" resultType="detalleEntregableProyecto">
		SELECT dep."ID_DETALLE_ENTREGABLE_PRODUCTO" id, 
		       dep."ID_PROYECTO" idproyecto, 
		       dep."ID_ENTREGABLE" identregable, 
		       dep."PRODUCTO" producto, 
		       dep."ESTADO" estado
		  FROM "PLANIFICAR_PROYECTO"."DETALLE_ENTREGABLE_PRODUCTO" dep
		  WHERE dep."ID_ENTREGABLE" = #{identregable}
		  AND   dep."ID_PROYECTO" = #{idProyecto}
		  AND   dep."ESTADO" = 1;
	</select>
	<!-- [FIN] ENTREGABLE -->
	
</mapper>